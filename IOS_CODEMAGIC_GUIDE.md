# üì± iOS Deployment Guide Using Codemagic (Without Mac)

This guide will help you deploy your TalebEdu app to the Apple App Store using Codemagic, without needing a Mac computer.

---

## üìã Prerequisites

Before starting, make sure you have:
- ‚úÖ Apple Developer Account ($99/year) - [developer.apple.com](https://developer.apple.com)
- ‚úÖ GitHub Account (free) - [github.com](https://github.com)
- ‚úÖ Codemagic Account (free tier available) - [codemagic.io](https://codemagic.io)
- ‚úÖ Your Lovable project exported to GitHub

---

## Phase 1: Apple Developer Setup

### 1.1 Create App Store Connect API Key

1. **Login to App Store Connect**
   - Go to: [appstoreconnect.apple.com](https://appstoreconnect.apple.com)
   - Sign in with your Apple Developer account

2. **Generate API Key**
   - Click "Users and Access" in the top menu
   - Click the "Keys" tab
   - Click the ‚ûï button to create a new key
   - **Name:** Codemagic CI/CD
   - **Access:** Developer (or Admin)
   - Click "Generate"
   
3. **Download and Save**
   - ‚ö†Ô∏è **CRITICAL**: Download the `.p8` file immediately (you can only download it once!)
   - Save the following information (you'll need these later):
     - **Key ID**: (example: `A1B2C3D4E5`)
     - **Issuer ID**: (example: `12345678-1234-1234-1234-123456789012`)
     - **Key file**: `AuthKey_A1B2C3D4E5.p8`

### 1.2 Register Your App Bundle ID

1. **Go to Certificates, Identifiers & Profiles**
   - URL: [developer.apple.com/account/resources](https://developer.apple.com/account/resources)
   
2. **Register Bundle Identifier**
   - Click "Identifiers" ‚Üí ‚ûï button
   - Select "App IDs" ‚Üí Continue
   - **Description**: TalebEdu
   - **Bundle ID**: `app.lovable.talebedu` (must match your capacitor.config.ts)
   - **Capabilities**: Enable:
     - Push Notifications
     - Sign in with Apple (if needed)
   - Click "Continue" ‚Üí "Register"

### 1.3 Create App in App Store Connect

1. **Create New App**
   - Go to [appstoreconnect.apple.com/apps](https://appstoreconnect.apple.com/apps)
   - Click the ‚ûï button ‚Üí "New App"
   
2. **Fill App Information**
   - **Platform**: iOS
   - **Name**: TalebEdu (or your preferred name)
   - **Primary Language**: English
   - **Bundle ID**: Select `app.lovable.talebedu`
   - **SKU**: `talebedu` (any unique identifier)
   - **User Access**: Full Access
   - Click "Create"

---

## Phase 2: GitHub Repository Setup

### 2.1 Export Project to GitHub

1. **In Lovable Editor**
   - Click the GitHub button (top right)
   - Click "Export to GitHub"
   - Choose a repository name: `talebedu-app`
   - Click "Export"

2. **Clone Locally** (optional, for testing)
   ```bash
   git clone https://github.com/YOUR_USERNAME/talebedu-app.git
   cd talebedu-app
   npm install
   ```

---

## Phase 3: Codemagic Setup

### 3.1 Connect Codemagic to GitHub

1. **Sign Up / Login**
   - Go to [codemagic.io](https://codemagic.io)
   - Click "Sign up with GitHub"
   - Authorize Codemagic to access your repositories

2. **Add Application**
   - Click "Add application"
   - Select your `talebedu-app` repository
   - Choose "Capacitor App"
   - Click "Finish"

### 3.2 Configure App Store Connect Integration

1. **Go to Team Settings**
   - Click your team name (top right) ‚Üí "Team settings"
   
2. **Add App Store Connect API Key**
   - Click "Integrations" tab
   - Scroll to "App Store Connect"
   - Click "Add key"
   - **Key name**: Production
   - **Issuer ID**: (paste from Phase 1.1)
   - **Key ID**: (paste from Phase 1.1)
   - **Key file**: Upload the `.p8` file (from Phase 1.1)
   - Click "Save"

### 3.3 Add Code Signing

1. **In App Settings**
   - Go to your app in Codemagic
   - Click "Settings" (top right)
   
2. **iOS Code Signing**
   - Scroll to "Code signing"
   - Click "iOS code signing"
   - **Method**: Select "Automatic" (Codemagic will handle certificates)
   - **App Store Connect API key**: Select the key you just added
   - **Certificate**: Select "iOS Distribution"
   - Click "Save"

---

## Phase 4: Configure Build Files

### 4.1 Update `codemagic.yaml`

Your `codemagic.yaml` file is already in the project. Update these values:

```yaml
workflows:
  ios-workflow:
    name: iOS Production
    environment:
      vars:
        # REQUIRED: Add these in Codemagic UI
        # APP_STORE_CONNECT_ISSUER_ID: from Phase 1.1
        # APP_STORE_CONNECT_KEY_IDENTIFIER: from Phase 1.1
        # APP_STORE_CONNECT_PRIVATE_KEY: content of .p8 file
        # CERTIFICATE_PRIVATE_KEY: will be auto-generated by Codemagic
        XCODE_WORKSPACE: "ios/App/App.xcworkspace"
        XCODE_SCHEME: "App"
        BUNDLE_ID: "app.lovable.talebedu"
```

### 4.2 Set Environment Variables in Codemagic

1. **In App Settings ‚Üí Environment variables**
   - Click "Add variable"
   - Add the following (mark as "Secure"):

   | Variable Name | Value | Secure |
   |---------------|-------|--------|
   | `APP_STORE_CONNECT_ISSUER_ID` | Your Issuer ID from Phase 1.1 | ‚úÖ |
   | `APP_STORE_CONNECT_KEY_IDENTIFIER` | Your Key ID from Phase 1.1 | ‚úÖ |
   | `APP_STORE_CONNECT_PRIVATE_KEY` | Full content of your .p8 file | ‚úÖ |
   | `SUPABASE_URL` | Your Supabase URL | ‚ùå |
   | `SUPABASE_ANON_KEY` | Your Supabase Anon Key | ‚ùå |
   | `BUNDLE_ID` | `app.lovable.talebedu` | ‚ùå |

2. **How to get .p8 file content:**
   ```bash
   # Open the .p8 file in a text editor
   # Copy ALL content including:
   # -----BEGIN PRIVATE KEY-----
   # (the key content)
   # -----END PRIVATE KEY-----
   ```

---

## Phase 5: First Build

### 5.1 Trigger Build

1. **In Codemagic Dashboard**
   - Go to your app
   - Click "Start new build"
   - **Branch**: `main` (or your default branch)
   - **Workflow**: Select "ios-workflow"
   - Click "Start new build"

2. **Monitor Build Progress**
   - Watch the build logs in real-time
   - Build typically takes 10-20 minutes
   - ‚òï Get some coffee!

### 5.2 Common Build Errors & Solutions

| Error | Solution |
|-------|----------|
| **Certificate not found** | Ensure App Store Connect integration is correct in Team settings |
| **Bundle ID mismatch** | Verify BUNDLE_ID matches in capacitor.config.ts and Xcode project |
| **Provisioning profile error** | Delete and regenerate certificates in Apple Developer portal |
| **Node modules error** | Add `npm install` step before build in codemagic.yaml |
| **Capacitor sync error** | Ensure `npx cap sync ios` runs before build |

---

## Phase 6: TestFlight & App Store Submission

### 6.1 Automatic TestFlight Upload

If your build succeeds, Codemagic will automatically:
- ‚úÖ Upload the `.ipa` file to App Store Connect
- ‚úÖ Submit to TestFlight for beta testing
- ‚úÖ Send you an email notification

### 6.2 Configure TestFlight

1. **In App Store Connect**
   - Go to your app ‚Üí "TestFlight" tab
   - Wait for build to process (5-10 minutes)
   
2. **Add Test Information**
   - Click on your build version
   - Add:
     - **What to Test**: Brief description of features
     - **Test Notes**: Any special instructions
     - **Beta App Review Information**: Contact info
   - Click "Save"

3. **Add Testers**
   - Click "Internal Testing" or "External Testing"
   - Click ‚ûï ‚Üí Add testers by email
   - Testers will receive an invite to download TestFlight app

### 6.3 Submit to App Store

1. **Prepare App Store Listing**
   - Go to your app ‚Üí "App Store" tab ‚Üí "App Information"
   - Fill in:
     - **App Name**: TalebEdu
     - **Subtitle**: School Management System
     - **Category**: Education
     - **App Screenshots**: (1242x2688, 1242x2208, 2048x2732)
     - **App Description**: Detailed description
     - **Keywords**: school, education, management, tracking
     - **Support URL**: Your website
     - **Privacy Policy URL**: Required

2. **Create New Version**
   - Click ‚ûï next to "iOS App"
   - **Version**: 1.0.0
   - **Build**: Select the build from TestFlight
   - **What's New**: Initial release
   
3. **Submit for Review**
   - Click "Add for Review"
   - Answer questionnaires (encryption, content rights, etc.)
   - Click "Submit"
   - ‚è∞ Review typically takes 24-48 hours

---

## Phase 7: Automatic Builds (CI/CD)

### 7.1 Setup Automatic Builds

1. **In Codemagic App Settings**
   - Go to "Build triggers"
   - Enable "Trigger on push"
   - Select branch: `main`
   - Save

2. **Now Every Time You Push Code:**
   ```bash
   git add .
   git commit -m "Update app features"
   git push origin main
   ```
   - Codemagic automatically builds
   - Uploads to TestFlight
   - Testers get the update!

### 7.2 Build Status Badges (Optional)

Add to your README.md:
```markdown
![Build Status](https://api.codemagic.io/apps/YOUR_APP_ID/status_badge.svg)
```

---

## üéØ Quick Reference Checklist

### Before First Build:
- [ ] Apple Developer Account created
- [ ] App Store Connect API Key generated and downloaded
- [ ] Bundle ID registered in Apple Developer portal
- [ ] App created in App Store Connect
- [ ] Project exported to GitHub
- [ ] Codemagic connected to GitHub
- [ ] App Store Connect integrated in Codemagic
- [ ] Environment variables set in Codemagic
- [ ] Code signing configured

### For Each Release:
- [ ] Code pushed to GitHub main branch
- [ ] Build triggered in Codemagic
- [ ] Build succeeds and uploads to TestFlight
- [ ] Test the build on TestFlight
- [ ] Submit to App Store review
- [ ] Respond to any review feedback
- [ ] Release to public after approval

---

## üÜò Common Issues

### Issue: "No valid signing identity"
**Solution**: In Codemagic, delete all iOS certificates and regenerate them using the automatic flow.

### Issue: "Bundle ID mismatch"
**Solution**: Verify these match:
- `capacitor.config.ts` ‚Üí `appId`
- `ios/App/App.xcodeproj` ‚Üí Bundle Identifier
- Apple Developer Portal ‚Üí Identifier

### Issue: "Build times out"
**Solution**: 
- Check your build logs for specific errors
- Ensure all dependencies are in `package.json`
- Try building locally first to catch errors early

### Issue: "App Store Connect upload fails"
**Solution**:
- Verify API key permissions (should be "Admin" or "Developer")
- Check that the key hasn't expired
- Regenerate the key if needed

---

## üìö Useful Resources

- **Codemagic Docs**: [docs.codemagic.io/getting-started/capacitor](https://docs.codemagic.io/getting-started/capacitor/)
- **Apple Developer**: [developer.apple.com](https://developer.apple.com)
- **App Store Review Guidelines**: [developer.apple.com/app-store/review/guidelines](https://developer.apple.com/app-store/review/guidelines/)
- **Capacitor iOS Docs**: [capacitorjs.com/docs/ios](https://capacitorjs.com/docs/ios)
- **TestFlight Beta Testing**: [developer.apple.com/testflight](https://developer.apple.com/testflight/)

---

## üéâ Success!

Once approved, your app will be live on the App Store! üöÄ

To update the app in the future:
1. Make changes in Lovable
2. Export to GitHub (or push commits)
3. Codemagic builds automatically
4. New version uploaded to TestFlight
5. Submit update to App Store for review
